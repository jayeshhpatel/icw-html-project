<!DOCTYPE html>
<html>
    <head>
        <title>Home | DC Triathlon Club</title>
        <meta name="theme-color" content="#0D3A73">
        <meta name="msapplication-TileColor" content="#0D3A73">
        <meta charset='utf-8'>
        <meta http-equiv='X-UA-Compatible' content='IE=edge'>
        <meta name='viewport' content='width=device-width, initial-scale=1'>
        <meta name="robots" content="noindex, nofollow" />

        <link rel="shortcut icon" href="assets/images/favicon/favicon.ico">
        <link rel="apple-touch-icon" sizes="180x180" href="assets/images/favicon/apple-touch-icon.png">
        <link rel="icon" type="image/png" sizes="32x32" href="assets/images/favicon/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="assets/images/favicon/favicon-16x16.png">
        <link rel="manifest" href="assets/images/favicon/site.webmanifest">

        <link href="assets/css/bootstrap.min.css" rel="stylesheet">
        <link href="assets/css/splide.min.css" rel="stylesheet">
        <link href="assets/css/main.css" rel="stylesheet">
        <script src="assets/js/jquery.min.js"></script>
        
    </head>
    <body>
        <header class="main-header">
            <nav class="navbar navbar-expand-lg">
                <div class="container">
                    <a class="navbar-brand" href="#"><img src="assets/images/logo.svg" alt="DC Triathlon Club"></a>
                </div>
            </nav>
        </header>
        <main class="main-content-wrapper">
            <section class="main-section tab-section">
                <div class="container">
                <header class="entry-header">
                    <h1 class="entry-title">Membersâ€™ List</h1>
                </header>
                <link rel="stylesheet" href="//cdn.datatables.net/2.1.8/css/dataTables.dataTables.css" type="text/css" media="all" />
                <link rel="stylesheet" href="//cdn.datatables.net/datetime/1.5.4/css/dataTables.dateTime.min.css" type="text/css" media="all" />
                <link rel="stylesheet" href="//cdn.datatables.net/buttons/3.1.2/css/buttons.dataTables.css" type="text/css" media="all" />        
                
                <div class="entry-content">
                    <div id="kitlist-filter" class="filter-input-block" style="display: flex; align-items: flex-end;">
                        <div>
                            <label>Start Date</label>
                            <div><input type="text" id="min" name="min"></div>
                        </div>
                        <div>
                            <label>Expiration Date</label>
                            <div><input type="text" id="max" name="max"></div>
                        </div>
                        <div class="level-select">

                        </div>
                        <div><button type="button" class="btn btn-danger" id="reset-btn">Reset</button></div>
                    </div>
                    <table id="kitlist" class="icw-datatable display compact hover stripe wp-list-table widefat fixed striped table-view-list posts" style="width:100%">
                        <thead>
                            <tr>
                                <th class="no-sort" style="width:50px">#</th>
                                <th>Member ID</th>
                                <th>Member Name</th>
                                <th>Email</th>
                                <th>Level</th>
                                <th>Membership Start Date</th>
                                <th>Expiration Date</th>
                                <th>Membership Kit</th>
                                <th>Membership Kit Sizes</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>1</td>
                                <td><a href='http://dctriclub.local/wp-admin/user-edit.php?user_id=4918'>_DemoTest20240324</a></td>
                                <td>Demo Test</td>
                                <td>bauerj4@yahoo.com</td>
                                <td>Club Membership (2 Year)</td>
                                <td>May 22, 2024</td>
                                <td>May 22, 2025</td>
                                <td>Kit A: Water Bottle</td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>2</td>
                                <td><a href='http://dctriclub.local/wp-admin/user-edit.php?user_id=5458'>_demotest20240521</a></td>
                                <td>_DemoTest20240521F _DemoTest20240521L</td>
                                <td>web+20240521@dctriclub.org</td>
                                <td>Club Membership (1 Year)</td>
                                <td>May 21, 2024</td>
                                <td>May 21, 2025</td>
                                <td>Kit A: Water Bottle</td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>3</td>
                                <td><a href='http://dctriclub.local/wp-admin/user-edit.php?user_id=5457'>kal01</a></td>
                                <td>Kal01 Hadi01</td>
                                <td>classroom-01@amananet.com</td>
                                <td>Club Membership (4 Year)</td>
                                <td>May 9, 2024</td>
                                <td>May 9, 2025</td>
                                <td>Kit B: Water Bottle/T-Shirt (Select size)</td>
                                <td>Shirt Female L</td>
                            </tr>
                            <tr>
                                <td>4</td>
                                <td><a href='http://dctriclub.local/wp-admin/user-edit.php?user_id=5456'>kal9</a></td>
                                <td>Kal9 Hadi9</td>
                                <td>classroom-09@amananet.com</td>
                                <td>Club Membership (1 Year)</td>
                                <td>May 8, 2024</td>
                                <td>May 8, 2025</td>
                                <td>Kit B: Water Bottle/T-Shirt (Select size)</td>
                                <td>Shirt Female M</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <script type="text/javascript" src="//cdn.datatables.net/2.1.8/js/dataTables.js"></script>
                <script type="text/javascript" src="//cdn.datatables.net/buttons/3.1.2/js/dataTables.buttons.js"></script>
                <script type="text/javascript" src="//cdn.datatables.net/buttons/3.1.2/js/buttons.dataTables.js"></script>
                <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
                <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
                <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>
                <script type="text/javascript" src="//cdn.datatables.net/buttons/3.1.2/js/buttons.html5.min.js"></script>
                <script type="text/javascript" src="//cdn.datatables.net/buttons/3.1.2/js/buttons.print.min.js"></script>
                <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.2/moment.min.js"></script>
                <script type="text/javascript" src="//cdn.datatables.net/datetime/1.5.4/js/dataTables.dateTime.min.js"></script>                
                <script>

                    DataTable.ext.oSort['date-uk-pre'] = function (a) {
                        if (a === null || a === '') {
                            return 0;
                        }
                        var ukDatea = a.split('/');
                        return (ukDatea[2] + ukDatea[0] + ukDatea[1]) * 1; // MM 2/DD 0/YYYY 1
                    };

                    DataTable.ext.oSort['date-uk-asc'] = function (a, b) {
                        return ((a < b) ? -1 : ((a > b) ? 1 : 0));
                    };

                    DataTable.ext.oSort['date-uk-desc'] = function (a, b) {
                        return ((a < b) ? 1 : ((a > b) ? -1 : 0));
                    };                   

                    function getFirstDayOfMonth() {
                        let date = new Date();
                        return new Date(date.getFullYear(), date.getMonth(), 1); // First day of the current month (01)
                    }

                    function getLastDayOfMonth() {
                        let date = new Date();
                        return new Date(date.getFullYear(), date.getMonth() + 1, 0); // Last day of the current month
                    }

                    // Format date to YYYY-MM-DD for input field
                    function formatDate(date) {
                        return date.toLocaleDateString('en-US', {
                            year: 'numeric',
                            month: 'short',  // This gives a 3-letter month (e.g., "Oct")
                            day: '2-digit'
                        });
                    }

                    // Set default values for min and max dates in the input fields
                    document.addEventListener('DOMContentLoaded', function () {
                        // Set the default min to the first day of the current month
                        document.getElementById('min').value = formatDate(getFirstDayOfMonth());
                        // Set the default max to the last day of the current month
                        document.getElementById('max').value = formatDate(getLastDayOfMonth());
                    });

                    // Initialize DateTime pickers for min and max dates
                    let minDate = new DateTime('#min', {
                        format: 'MMM DD, YYYY'
                    });
                    let maxDate = new DateTime('#max', {
                        format: 'MMM DD, YYYY'
                    });

                    // DataTable search function for date range
                    $.fn.dataTable.ext.search.push(function (settings, data, dataIndex) {
                        // Parse min and max values from date inputs
                        let min = new Date(minDate.val()); // Get the selected min date
                        let max = new Date(maxDate.val()); // Get the selected max date

                        // Parse the date from two specific columns (e.g., columns 5 and 6)
                        let dateCol1 = new Date(data[5]); // First date column (index 5)
                        let dateCol2 = new Date(data[6]); // Second date column (index 6)

                        // Check if either date in the two columns falls within the min/max range
                        if (
                            ((isNaN(min) && isNaN(max)) || (isNaN(min) && dateCol1 <= max) || (min <= dateCol1 && isNaN(max)) || (min <= dateCol1 && dateCol1 <= max)) &&
                            ((isNaN(min) && isNaN(max)) || (isNaN(min) && dateCol2 <= max) || (min <= dateCol2 && isNaN(max)) || (min <= dateCol2 && dateCol2 <= max))
                        ) {
                            return true;
                        }
                        return false;
                    });

                    // DataTables initialization
                    let table = new DataTable('#kitlist', {
                        layout: {
                            topStart: {
                                buttons: ['copy', 'csv', 'excel', 'pdf', 'print']
                            }
                        },
                        initComplete: function () {
                        this.api().columns([4]).every(function () {
                            var column = this;
                            var select = $('<select><option value="">ALL</option></select>')
                                .appendTo($('#kitlist-filter .level-select'))
                                .on("change", function () {
                                    var val = $.fn.dataTable.util.escapeRegex($(this).val());

                                    column.search(val ? "^" + val + "$" : "", true, false).draw();
                                });

                            // Add the options dynamically
                            column
                                .data()
                                .unique()
                                .sort()
                                .each(function (d, j) {
                                    select.append('<option value="' + d + '">' + d + '</option>');
                                });

                            // Select the second option (index 1)
                            select.prop('selectedIndex', 1);

                            // Trigger change event to filter the table based on the second option
                            select.trigger('change');
                        });
                    }
                    });

                    // Re-filter the table when date inputs change
                    document.querySelectorAll('#min, #max').forEach((el) => {
                        el.addEventListener('change', function () {
                            table.draw();
                        });
                    });         
                    // Reset button click event
                    document.getElementById('reset-btn').addEventListener('click', function () {
                        location.reload();
                    });
                </script>
            </section>
        </main>
        <script src="assets/js/bootstrap.min.js"></script>
        <script src="assets/js/splide.min.js"></script>
        <script src="assets/js/main.js"></script>
    </body>
</html>